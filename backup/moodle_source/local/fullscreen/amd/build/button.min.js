define(["jquery","core/log","core/templates","core/ajax","core/notification"],function(a,b,c,d,e){var f={attachBoost:"#region-main > .card-block",attachClean:"#region-main",button:".local-fullscreen"},g={toggle:"fullscreenmode",fixed:"fixed","float":"float"},h={button:"local_fullscreen/button"},i=!1,j=function(b){var c=a(b),d=a(f.attachBoost);0===d.length&&(d=a(f.attachClean)),d.prepend(c),a(f.button).click(o);var e=a(document);e.keydown(l),e.keyup(m),e.scroll(n)},k=function(d){b.debug("Adding fullscreen button to the page (fullscreen="+d+")","local_fullscreen/button"),1==d&&a("body").addClass(g.toggle),c.render(h.button,[]).then(j)},l=function(a){i!==!0&&"b"===a.key&&a.ctrlKey!==!1&&a.altKey!==!1&&(i=!0,o(a))},m=function(a){i!==!1&&"b"===a.key&&a.ctrlKey!==!1&&a.altKey!==!1&&(i=!1)},n=function(){window.pageYOffset>205?a(f.button).addClass(g["float"]):a(f.button).removeClass(g["float"])},o=function(){var b,c=a("body");c.hasClass(g.toggle)?(c.removeClass(g.toggle),b=!1):(c.addClass(g.toggle),b=!0),p(b)},p=function(a){var b={methodname:"core_user_update_user_preferences",args:{preferences:[{type:"fullscreenmode",value:a}]}};return d.call([b])[0].fail(e.exception)};return{init:k}});